### 2023 年 05/30(火)

## 取り組んだ課題

達人 DB 本

バックアップの章から理論設計のバットノウハウ

## わかったこと

バックアップ方式は 3 つある

- フルバックアップ(完全バックアップ)
- 差分バックアップ
- 増分バックアップ

基本的には 1 個の方式のみならず複数の方式を使う

フルバックアップ＋差分または増分みたいな感じ

---

リストアおよびリカバリの手順は以下の三段階となる

- フルバックアップのファイルをデータベースに戻す ⇒ リストア
- 差分(または増分)バックアップしていたトランザクションログを適用 ⇒ リカバリ
- データベースサーバーに残っているトランザクションログを適用する ⇒ ロールフォワード

スッキリ SQL で学んだロールフォワードでできました！

これで、障害発生直前のデータが復旧できます！！(復活)

### 二次元表とテーブルは違う！！

- 二次元表は共通点なしで好き勝手にデータが入っている
- テーブルは共通点を持ったレコードの集合である。

テーブルとは、同じ種類の物の集合であるなので**テーブル名は複数形または複数名詞で書くこと。**

### 主キー

主キーは必ず１つ存在する！(1 つだけ)

### 外部キー

外部キーは人間の親子関係と同じ

主キーが親で外部キーが子供

主キーで登録されてないのに、外部キーでレコードに登録しようとしてもできない。

親がいないのに子供はいないのは当たり前ですね！(わかりやすい)

### 正規化とは何か？

DB で保持するデータの冗長性を排除し、一貫性と効率性を保持するためのデータ形式

正規形のレベルは第５まであるが、普通は第３正規形まで理解すれば十分！

第一正規形は 1 つのセルの中には 1 つの値しか含まれない！

これがクリアできていたら第一正規形はクリア！

### 第２正規形、部分関数従属

主キーの一部の列に対して従属する列がある場合、この関係は部分関数従属

これに対し、主キーを構成する全ての列従属性がある場合、完全関数従属と呼びます！

第２正規形のクリア条件はテーブル内で部分関数従属を解消し完全関数従属のみのテーブルを作れば完成です！

### 第三正規形　推移的関数従属

２段階の関数従属があり、テーブル内部に段階的な従属関係のことを推移的関数従属と呼びます

例：｛商品コード｝ → ｛製造業者コード｝ → ｛製造業者名｝

例えば、こんな感じに商品テーブルに推移的関数従属があるとします。

これはもう一つ製造業者テーブルを作ってあげてカラムは製造業者コードと製造業者名を作れば第３正規形のクリアです！！

まとめると各テーブル内の非キー列はキー列に対してのみ従属する様すれば OK!!

### このように正規化することによる利点

- データの冗長性が排除され、更新時の不整合を防止できる！
- テーブルの持つ意味が明確になり、開発者が理解しやすい。(確かにわかりやすい)

### ただし欠点もある

テーブルの数が増えるため、**SQL 文で結合を多用することになり**、パフォーマンスが悪化する。

世の中甘くないですね、、便利なる反面、副作用もあるのです。。。

**B-tree インデックスでなんとかカバーできそうです。**

### B-tree インデックスはどの列に作ればいいか？

**インデックスは闇雲につけるのは NG**

ポイント!!

- 大規模なテーブルに対して作成する
  データ量が少ない場合はインデックスの効果はない。

- カーディナリティの高い列に作成する
  カラムに入るデータが 3 択だと 3 カーディナリティですのでこれは非常に小さいです

  一方受付日とかで考えると 1 年で 365 日ですので多くて 365 カーディナリティです。
  高いので B-tree インデックスを作っても良いでしょう！
  なので受付日に B-tree インデックスを作る意味はあると判断できます!

- SQL 文で **WHERE 句の選択条件、または結合条件に使用されている列**に作成する。
  LIKE 述語を使うときは、前方一致検索の場合のみ索引が使用される。

## 理論設計のバッドノウハウ

### 非スカラ値(第一正規形未満)

セルが二行以上になっている

SQL 文で配列はありえない

情報は可能な限り分割して保存するのがいい、ただし意味を壊してはいけない

例：full_name カラムを first_name と last_name に分けるなど

### ダブルミーニング

逆にどうやってやるのか知りたいですが(別に知りたくもない w)

同じ列に 2 つの意味を持つダブルミーニング状態になっていること。

カラム名一緒で同じ input タグで違う意味の情報を記入してるってこと？

**列は変数ではない。一度意味を決めたら変更不可。**

### 単一参照テーブル

あっ！このテーブル全く同じカラム構成だ！一緒にしちゃえ〜＾

このように同じ構造のテーブルをごった煮すること

### テーブル分割

水平分割は NG

例えば年数別でテーブル分けちゃうこと。

ふと思ったのですが、レコード量増えて分けたいのならアーカイブテーブル作ればいいと思います！

### 不適切のキー

可変長文字列は不変性がないためキーには不向き。

キーには固定長文字列のコード列が望ましい。

### ダブルマスタ

お互いに同じような役割を持っているテーブルが複数存在すること

普通にやっていれば起きないことですが

**システム総廃合で起きることが多いので注意。**

## 次やること

本読み終わりたい！そして感想文を書きます。

## 感じたこと

こんな長時間本読むのは生まれて初めてかもしれません。

昔じゃありえなかった。少しずつ自分の脳みそは進化してきてるのかなぁ。。。

頭使うの難しい。地頭おばか卒業したい

## 勉強時間

Today: 9h

Total: 350h
