## 2023 年 05/26(金)

## 取り組んだ課題

スッキリわかる SQL 入門

テーブル結合まで。

タイピング練習(30 分)

- 最近は長文タイピングしています！(タッチタイピングの良さがわかる。気持ちいい)

## わかったこと

代表的な集計関数(select 文でしか利用できない)

SUM: 各行の値の合計を求める
MAX: 各行の値の最大値を求める
MIN: 各行の値の最小値を求める
AVG: 各行の値の平均値を求める
COUNT:行数カウントをする

必ず集計関数を行なったら、返ってくるレコードは一行になる

SQL は凸凹で返すことはできないなので`GROUP BY`でグループ化してあげる。

そうすることで、その日付やらグループ化したカラム内容の集計が取得できる。

グループ化から条件をつける時は、WHERE 句ではなく、HAVING 句を指定！

理由は、やってることは変わらないが行う順番が違う為

WHERE 句はグループ化する前に行う

HAVING 句はグループ化した後に行う

### 副問い合わせ(サブクエリ)

本来は 2 つクエリを描かなくてはいけないことが１回のクエリでかける

副問い合わせの結果が１行１行になるものを**単一副問い合わせ**という

select 文や update 文の set 句などで利用できる。

---

副問い合わせの結果が n 行１行になるものを**複数行副問い合わせ**という。

比較演算子と組み合わせることで IN NOT IN ANY ALL 演算子を使ってできる

where 句の条件に用いる場合が多い。

---

副問い合わせの結果が n 行 m 行の表形式になる副問い合わせも利用される

FROM 句で検索し

INSERT 文に記述して検索結果をそのままの形でテーブルに登録することができる！

---

今月は家計簿テーブル

先月は家計簿アーカイブテーブル

合計値や最大値や平均値や最小値などの集計をまとめる家計簿集計テーブル

(集計した結果のみのデータが格納されている)

この様にテーブルをこまめに分けてあげることで DBMS の検索結果を早くすることができる。

---

疑問が一つ

アーカイブテーブルや集計テーブルは現場だと初めから作るのかな？

それともレコード数が多くなってきたら SQL でサブクエリで SUM と AVG 使って

既存のテーブルから計算してテーブルを新しく作るのかな？

---

### 複数のテーブルに分けるメリット

**分割されていた方がデータを安全、確実、高速に取り扱いやすい！！**

**テーブル分けていない時**

10 万行のデータがある家計簿テーブルにある費目の名前を更新するとき

10 万行全てに対して条件に一致するかを調べて書き換えることになる

この時あるカラムの１種類を変えたいだけなのに

重複ない様なので重複したぶん全部を検索し書き換えることになる

結果、処理の時間がかかるし DBMS が大変になる。

**分けている場合**

新しくあるカラム(例えば、genre とか)テーブルを作って名前カラムにジャンルの名前を入れてるとして

ジャンルの名前を格納するだけのテーブルなら

重複することはない為、多く見積もっても検索する行が 100 行程度ですむ。

なので条件にあうたった一行を書き換えることで処理が早く済み DBMS が楽になる。

テーブル設計する際の注意点

- 同じような内容を繰り返し登録した無駄の多い表は避けること!
- カラムはなるべく少なく
- N 対 N は避ける、などなど次読む本でもっとインプット

### 結合とは

テーブルを丸ごとつなぐのではなく、結合条件(ON)が満たされた行を１つ 1 つつなぐこと。

### 結合種類

- 内部結合

JOIN: NULL があったらその行は消滅する。(NULL の場合検索結果になくていい時に使えそう)

- 外部結合は３種類ある。

LEFT JOIN:左側のテーブル(FROM で指定した方)に NULL があっても無理矢理結合する

RIGHT JOIN:右側のテーブル(FROM で指定しない方)に NULL があっても無理矢理結合する

FULL JOIN: 必ず結合する！！！！

- 自己結合、再帰結合

同じテーブルを結合すること。

1 つのカラムに関連するカラムがあった場合使える。

必ず異なるエイリアスをつけること！！

- テーブル名の指定

結合するテーブルに同じ名前のカラムがある場合は`テーブル名.カラム名`で指定してあげること

この時にテーブル名が長くて面倒な時`FROM`や`JOIN`で指定する時に`AS`でエイリアスをつけることができる

例：`FROM 家計簿 AS K`これで家計簿の別名 K になりました

(名前を変えただけなので更新はされていない)

MySQL は`AS`無しでスペースを入れるだけでできる

3 つのテーブル以上でも結合,複雑すぎませんかね？

## 次やること

スッキリわかる SQL 入門

トランザクションから！

## 感じたこと

自分は本当に頭が硬い。

今まで学生時代も柔道一筋で 27 歳まで肉体労働で頭使ってなかった代償が。。。

柔らかくしたいです。どうしたものか。。。

明日はトランザクション！

めちゃくちゃ重要なところだからしっかりとインプットしていきたいです！

今日はオールインプットだった為日報が長くなってしまいました w

お疲れ様でした！

## 勉強時間

Today: 15h

Total: 319h
